<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>redis基础 | 雨水的天空落了雨</title><meta name="keywords" content="数据库,redis,noSql"><meta name="author" content="rain-Sky"><meta name="copyright" content="rain-Sky"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="为什么使用noSql noSql，不仅仅是sql  单机mysql时代在90年代，一个网站的访问量一般都不大，用单个数据库完全可以轻松应付。在那个时候，更多的都是静态网页，动态交互类型的网站不多，无论读写都在同一个实例中完成。   APP 应用端 DAL 数据访问层（jdbc，或者orm框架如mybaties，Hibernate等） mysql instance 数据库实例  Memcached+">
<meta property="og:type" content="article">
<meta property="og:title" content="redis基础">
<meta property="og:url" content="https://rain-sky.github.io/2021/07/24/redis%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="雨水的天空落了雨">
<meta property="og:description" content="为什么使用noSql noSql，不仅仅是sql  单机mysql时代在90年代，一个网站的访问量一般都不大，用单个数据库完全可以轻松应付。在那个时候，更多的都是静态网页，动态交互类型的网站不多，无论读写都在同一个实例中完成。   APP 应用端 DAL 数据访问层（jdbc，或者orm框架如mybaties，Hibernate等） mysql instance 数据库实例  Memcached+">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://rain-sky.github.io/img/ban.jpg">
<meta property="article:published_time" content="2021-07-24T07:41:03.000Z">
<meta property="article:modified_time" content="2021-08-02T09:06:47.970Z">
<meta property="article:author" content="rain-Sky">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="redis">
<meta property="article:tag" content="noSql">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://rain-sky.github.io/img/ban.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://rain-sky.github.io/2021/07/24/redis%E5%9F%BA%E7%A1%80/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="/rain-sky" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-08-02 17:06:47'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="雨水的天空落了雨" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://gitee.com/rain-sky/images/raw/master/20210516135239.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">30</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">32</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-film"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-heart"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/ban.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">雨水的天空落了雨</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-film"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 列表</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/bangumis/"><i class="fa-fw fas fa-heart"></i><span> 番剧</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">redis基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-07-24T07:41:03.000Z" title="Created 2021-07-24 15:41:03">2021-07-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-08-02T09:06:47.970Z" title="Updated 2021-08-02 17:06:47">2021-08-02</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">7.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>25min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="redis基础"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="为什么使用noSql"><a href="#为什么使用noSql" class="headerlink" title="为什么使用noSql"></a>为什么使用noSql</h2><blockquote>
<p>noSql，不仅仅是sql</p>
</blockquote>
<h3 id="单机mysql时代"><a href="#单机mysql时代" class="headerlink" title="单机mysql时代"></a>单机mysql时代</h3><p>在90年代，一个网站的访问量一般都不大，用单个数据库完全可以轻松应付。<br>在那个时候，更多的都是静态网页，动态交互类型的网站不多，无论读写都在同一个实例中完成。</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210726114217.png"></p>
<ul>
<li>APP 应用端</li>
<li>DAL 数据访问层（jdbc，或者orm框架如mybaties，Hibernate等）</li>
<li>mysql instance 数据库实例</li>
</ul>
<h3 id="Memcached-MySQL-垂直拆分"><a href="#Memcached-MySQL-垂直拆分" class="headerlink" title="Memcached+MySQL+垂直拆分"></a>Memcached+MySQL+垂直拆分</h3><p> 后来，随着访问量的上升，几乎大部分使用MySQL架构的网站在数据库上都开始出现了性能问题，web程序不再仅仅专注在功能上，同时也在追求性能。程序员们开始大量的使用缓存技术来缓解数据库的压力，优化数据库的结构和索引。开始比较流行的是通过文件缓存来缓解数据库压力，但是当访问量继续增大的时候，多台web机器通过文件缓存不能共享，大量的小文件缓存也带了了比较高的IO压力。在这个时候，Memcached就自然的成为一个非常时尚的技术产品。</p>
<p> Memcached作为一个独立的分布式的缓存服务器，为多个web服务器提供了一个共享的高性能缓存服务，在Memcached服务器上，又发展了根据hash算法来进行多台Memcached缓存服务的扩展，然后又出现了一致性hash来解决增加或减少缓存服务器导致重新hash带来的大量缓存失效的弊端。</p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210726114531.png" style="zoom:80%;">

<h3 id="Mysql主从读写分离"><a href="#Mysql主从读写分离" class="headerlink" title="Mysql主从读写分离"></a>Mysql主从读写分离</h3><p>由于数据库的写入压力增加，Memcached只能缓解数据库的读取压力。读写集中在一个数据库上让数据库不堪重负，大部分网站开始使用主从复制技术来达到读写分离，以提高读写性能和读库的可扩展性。</p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210726121707.png" style="zoom:80%;">

<ul>
<li>M 主服务器，负责写业务</li>
<li>S 从服务器，同步M数据</li>
</ul>
<h3 id="分库分表-水平拆分-mysql集群"><a href="#分库分表-水平拆分-mysql集群" class="headerlink" title="分库分表+水平拆分+mysql集群"></a>分库分表+水平拆分+mysql集群</h3><p>在Memcached的高速缓存，MySQL的主从复制，读写分离的基础之上，这时MySQL主库的写压力开始出现瓶颈，而数据量的持续猛增，由于MyISAM在写数据的时候会使用表锁，在高并发写数据的情况下会出现严重的锁问题，大量的高并发MySQL应用开始使用InnoDB引擎代替MyISAM。</p>
<ul>
<li>MyISAM 表锁</li>
<li>InnoDB 行锁</li>
</ul>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210726122057.png"></p>
<p><strong>一个现代互联网服务架构模型</strong></p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210726123128.png" style="zoom: 67%;">

<p>最前面的是企业级防火墙，后面通过负载均衡主机（软负载：Nginx，硬负载：F5）在 web 服务器集群之间进行调度，再由具体的 web 服务器（Tomcat）去访问缓存，访问数据库。</p>
<h3 id="noSql的优势"><a href="#noSql的优势" class="headerlink" title="noSql的优势"></a>noSql的优势</h3><ul>
<li><p>易扩展<br> NoSQL数据库种类繁多，但是一个共同的特点都是去掉关系数据库的关系型特性。数据之间无关系，这样就非常容易扩展。也无形之间，在架构的层面上带来了可扩展的能力。</p>
</li>
<li><p>大数据量，高性能<br> NoSQL数据库都具有非常高的读写性能，尤其在大数据量下，同样表现优秀。这得益于它的无关系性，数据库的结构简单。一般MySQL使用Query Cache，每次表的更新Cache就失效，是一种大粒度的Cache，在针对web2.0的交互频繁的应用，Cache性能不高。而NoSQL的Cache是记录级的，是一种细粒度的Cache，所以NoSQL在这个层面上来说就要性能高很多了。</p>
</li>
<li><p>灵活的数据模型<br> NoSQL无需事先为要存储的数据建立字段，随时可以存储自定义的数据格式。而在关系数据库里，增删字段是一件非常麻烦的事情。如果是非常大数据量的表，增加字段简直就是一个噩梦。这点在大数据量的web2.0时代尤其明显。</p>
</li>
<li><p>高可用<br> NoSQL在不太影响性能的情况，就可以方便的实现高可用的架构。比如Cassandra，HBase模型，通过复制模型也能实现高可用。</p>
</li>
</ul>
<p><strong>一些常用的nosql举例</strong></p>
<ul>
<li>CouchDB ：CouchDB是一种<strong>面向文档</strong>(document-oriented)的nosql数据库，文档的存储格式通过JSON进行描述，在结构部署上采用的是peer-based方式，即每台机器在功能上来讲是同等重要的，没有master和slave的区分，所存储的数据也都是相同的(没有做到数据的分布式存储)，类似于Subversion中版本库和工作拷贝的概念。</li>
<li>Redis：Redis是一种基于<strong>key-value存储格式</strong>的nosql数据库，在结构部署上采用了master/slave的方式，其中slave节点起到备份的作用，当master节点出现问题的时候，slave节点可替换成master，从而确保了系统安全稳定的特性。</li>
<li>MongoDB：同CouchDB一样，MongoDB也是一种<strong>面向文档</strong>的nosql数据库，所不同的是在存储方式上采用的是分布式存储，其部署结构与Redis相似(基于master/slave方式)，只不过功能组件较Redis划分的更加详细。</li>
</ul>
<p><strong>四种nosql对比</strong></p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210727145920.png"></p>
<h2 id="redis-介绍"><a href="#redis-介绍" class="headerlink" title="redis 介绍"></a>redis 介绍</h2><blockquote>
<p>基于redis6.x版</p>
</blockquote>
<p>Redis是一个开源（BSD许可），内存存储的数据结构服务器，可用作数据库，高速缓存和消息队列代理。它支持字符串、哈希表、列表、集合、有序集合，位图，hyperloglogs等数据类型。内置复制、Lua脚本、LRU收回、事务以及不同级别磁盘持久化功能，同时通过Redis Sentinel提供高可用，通过Redis Cluster提供自动分区。</p>
<p><strong>Redis与其他key-value存储有什么不同？</strong></p>
<ul>
<li>Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。</li>
<li>Redis运行在内存中但是可以持久化到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，应为数据量不能大于硬件内存。在内存数据库方面的另一个优点是， 相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样Redis可以做很多内部复杂性很强的事情。 同时，在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问。</li>
</ul>
<h3 id="linux下安装redis"><a href="#linux下安装redis" class="headerlink" title="linux下安装redis"></a>linux下安装redis</h3><p>准备好压缩包传输到Linux目录</p>
<p><strong>解压后得到redis</strong></p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210731174107.png"></p>
<p>进入解压后的文件</p>
<p>yum install gcc-c++</p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210731175718.png" style="zoom: 50%;">

<p>安装redis6.X以上版本安装6.0以上版本需要升级gcc到5.3及以上,如下：</p>
<p>运行下面命令升级gcc<br>#第一步<br>sudo yum install centos-release-scl<br>#第二步<br>sudo yum install devtoolset-7-gcc*<br>#第三步<br>scl enable devtoolset-7 bash</p>
<p>更新完成gcc后我们进入redis目录下，执行make</p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210731180138.png" style="zoom:50%;">

<p>至此redis基本安装完成，默认安装到/usr/local/bin目录下</p>
<p>复制一份redis配置文件到此目录下，修改此配置文件，daemonize修改为yes,让redis后台启动</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210731183404.png"></p>
<p>指定配置文件启动</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210731183637.png"></p>
<p>连接redis服务</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210731183754.png"></p>
<p>查看redis服务是否开启</p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210731183950.png" style="zoom:67%;">

<p>断开redis服务</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210731184120.png"></p>
<p>再次查看服务是否存在</p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210731184222.png" style="zoom:67%;">

<blockquote>
<p>redis的安装相关就到此搞一段落~💪</p>
</blockquote>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="redis数据库"><a href="#redis数据库" class="headerlink" title="redis数据库"></a>redis数据库</h3><p>redis默认有16个数据库，配置文件中可以看到，默认使用第0个，可以使用select命令切换数据库。</p>
<p>切换数据库：select  7</p>
<p>数据库大小：dbsize</p>
<p>输入一个键值对：set keyname value</p>
<p>得到一个value：get  keyname</p>
<p>修改key名称：rename key newkey</p>
<p>查询所有的key：key *</p>
<p>查询某个key是否存在：exists keynane</p>
<p>移除某一个key：move keyname  2（2代表从第二个数据库中移除）</p>
<p>查询某个key还剩多少时间过期：ttl keyname</p>
<p>设置某个键的过期时间：expire keyname 10(10s后过期)</p>
<p>查看当前key的类型：type keyname</p>
<p>清空当前数据库：flushdb</p>
<p>清空所有数据库：flushall</p>
<p><strong>redis是单线程的</strong></p>
<blockquote>
<p>redis是基于内存操作，cpu并不是redis的性能瓶颈，redis的瓶颈是机器的内存和网络带宽。</p>
</blockquote>
<p>为什么redis单线程这么快？</p>
<p>误区1：高性能的服务器一定是多线程的？</p>
<p>误区2：多线程一定比单线程效率高？</p>
<p>核心：redis是将所有数据存放于内存中的，所以说redis使用单线程是最快的，因为没有CPU上下文切换，对于内存系统来说，多次读写都是在一个CPU上的。</p>
<h3 id="五大数据类型"><a href="#五大数据类型" class="headerlink" title="五大数据类型"></a>五大数据类型</h3><h4 id="String字符串类型"><a href="#String字符串类型" class="headerlink" title="String字符串类型"></a>String字符串类型</h4><hr>
<p>基本命令操作：</p>
<p>set  name  rain 输入一个字符串类型为 rain</p>
<p>append name sky 给名为name的key追加字符sky，所以追加后为rainsky（若指定keyname不存在，则相当于set key）</p>
<p>strlen name 获取name的长度，rainsky即为7</p>
<p>set num 1 设置num初始值为1</p>
<p>incr num使num自增1.即为2</p>
<p>decr num使num自减1，即为1</p>
<p>incrby num 10 使num自增10</p>
<p>decrby num 10使num自减10</p>
<hr>
<p>set str “hello,world!”</p>
<p>getrange str 0 4获取str0-4区间内容（闭区间），即为hello</p>
<p>setrange str 1 xxxx从指定位置开始用指定字符串作替换，即为hxxxx,world!</p>
<hr>
<blockquote>
<p>setex与setnx</p>
</blockquote>
<p>SETEX key seconds value</p>
<p>含义：</p>
<p>​     将值 value 关联到 key ，并将 key 的生存时间设为 seconds (以秒为单位)。</p>
<p>​     如果 key 已经存在， SETEX 命令将覆写旧值。</p>
<p>返回值：</p>
<p>​     设置成功时返回 OK 。</p>
<p>​     当 seconds 参数不合法时，返回一个错误。</p>
<p>SETNX key value（分布式锁常用）</p>
<p>含义：</p>
<p>​     将 key 的值设为 value ，当且仅当 key 不存在。</p>
<p>​     若给定的 key 已经存在，则 SETNX 不做任何动作。</p>
<p>​     SETNX 是『SET if Not eXists』(如果不存在，则 SET)的简写。</p>
<p>返回值：</p>
<p>​     设置成功，返回 1 。</p>
<p>​     设置失败，返回 0 。</p>
<blockquote>
<p>mset与mget，msetnx</p>
</blockquote>
<p>mset k1 v1 k2 v2 k3 v3…一次性输入多个值</p>
<p>mget k1 k2 k3 一次性获取多个值</p>
<p>msetnx k1 v1 k2 v2 …一次性设置多个值，如果有一个key已经存在，则整个句子执行失败（原子性）</p>
<blockquote>
<p>设置一个对象</p>
</blockquote>
<p>如：set user:1 {name:rain,age:14}</p>
<p>另一种设计：</p>
<p>mset user:1:name rain user:1:age 14</p>
<blockquote>
<p>getset组合命令</p>
</blockquote>
<p>getset name rainsky 先获取值再重新设置值，不存在则返回nil</p>
<h4 id="List列表"><a href="#List列表" class="headerlink" title="List列表"></a>List列表</h4><p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部，可存在重复值。</p>
<p><strong>基本用法</strong></p>
<p>此处list列表名即为key</p>
<p>lpush list cat 往名为list的列表左侧添加一个cat</p>
<p>若再一次添加dog，pig，则此列表中就有三个元素</p>
<p>lrange list 0 -1 输出列表中的元素，如上的话则为pig dog cat</p>
<p>rpush list duck 往列表右侧添加一个元素</p>
<p>lpop list移除list队列左侧第一个元素</p>
<p>rpop list移除list右侧第一个元素</p>
<p>lindex list 1 获取list中下标为1的元素</p>
<p>llen list 获取列表长度</p>
<p>lrem list 1 cat 移除list中一个cat ，1为移除的个数</p>
<p>ltrim list n1 n2 阶段list为n1,n2中间的元素，闭区间</p>
<p>rpoplpush list1  list2 把list1中的最右边一个元素添加到list2最左边</p>
<p>lset list 0 item 将list列表中指定下标处的值更新为指定值，如果不存在列表或下标越界将会报错</p>
<p>linsert list before v2 nv 往v2的左侧插入一个nv，同样也有after插入</p>
<p><strong>一些应用</strong></p>
<p>消息队列，生产者消费者等</p>
<h4 id="set集合"><a href="#set集合" class="headerlink" title="set集合"></a>set集合</h4><p>Redis 的 Set 是 String 类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。集合对象的编码可以是 intset 或者 hashtable。Redis 中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。</p>
<p><strong>基本用法</strong></p>
<p>此处set集合名即为key值</p>
<p>sadd myset hello 往myset中存入hello</p>
<p>smembers myset 列出myset中所有值</p>
<p>sismember myset hello 查询myset中是否含有hello这个值，有返回1，无0</p>
<p>scard myset 获取元素个数</p>
<p>srem myset hello 删除hello</p>
<p>spop myset 随机删除一个元素</p>
<p>srandmember  myset从指定集合中随机抽取一个元素</p>
<p>smove myset myset2  “hello” 将myset中hello元素移动到myset2中</p>
<p>sdiff set1 set2 查询set1与set2的差集</p>
<p>sinter set1 set2 交集(共同关注<span class="github-emoji"><span>😄</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> )</p>
<p>sunion set1 set2 并集</p>
<h4 id="Hash哈希"><a href="#Hash哈希" class="headerlink" title="Hash哈希"></a>Hash哈希</h4><p>Redis hash 是一个 string 类型的 field（字段） 和 value（值） 的映射表，hash 特别适合用于存储对象，就像map。</p>
<p><strong>基本用法</strong></p>
<p>hset myhash name rainsky将name-&gt;rainsky键值对（哈希值）存入myhash这个哈希表</p>
<p>hget myhash name 从myhash中获取key为name的value</p>
<p>hmset myhash name rainsky age 18 存入多个哈希值</p>
<p>hmget myhash name age 获取哈希表中多个key对应的value值</p>
<p>hgetall myhash 获取所有哈希值，结果以key换行value换行key换行value换行…显示</p>
<p>hdel myhash name 删除myhash哈希表中name对应的哈希值</p>
<p>hlen myhash 获取哈希表哈希值个数</p>
<p>exists myhash name判断name为key的哈希值是否存在于myhash中</p>
<p>hkeys myhash获取所有key</p>
<p>hvals myhash获取所有value</p>
<p>hincrby myhash age  1 让age对应value自增1</p>
<p>hsetnx myhash name rain 当此哈希值不存在时插入指定哈希值</p>
<h4 id="zset有序集合"><a href="#zset有序集合" class="headerlink" title="zset有序集合"></a>zset有序集合</h4><p>Redis 有序集合和集合一样也是 string 类型元素的集合,且不允许重复的成员。</p>
<p>不同的是每个元素都会关联一个 double 类型的分数。redis 正是通过分数来为集合中的成员进行从小到大的排序。集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。 集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。</p>
<p><strong>基本用法</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 1 redis 分数为1处元素为redis</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 2 mongodb</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 3 mysql</span><br><span class="line">(integer) 1</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 3 mysql</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; ZADD runoobkey 4 mysql</span><br><span class="line">(integer) 0</span><br><span class="line">redis 127.0.0.1:6379&gt; ZRANGE runoobkey 0 10 WITHSCORES 输出zset中score再0-10区间的内容并把score连带升序输出</span><br><span class="line"></span><br><span class="line">1) "redis"</span><br><span class="line">2) "1"</span><br><span class="line">3) "mongodb"</span><br><span class="line">4) "2"</span><br><span class="line">5) "mysql"</span><br><span class="line">6) "4"</span><br><span class="line"></span><br><span class="line">zrem runoobkey redis 移除一个指定元素</span><br><span class="line">zcard runoobkey 查看元素个数</span><br><span class="line">zrevrange myzset 降序排序，默认是升序</span><br><span class="line">zcount myset n1 n2获取n1 n2区间的元素个数</span><br><span class="line">zrangebyscore myzset -inf +inf 将zset中元素按score排序，score范围为-inf到+inf</span><br></pre></td></tr></tbody></table></figure>

<p>可以有什么应用呢？</p>
<p>存储带权重（score）的数据，然后排序，如各种排行榜。</p>
<h3 id="三种特殊数据类型"><a href="#三种特殊数据类型" class="headerlink" title="三种特殊数据类型"></a>三种特殊数据类型</h3><h4 id="geospatial地理位置"><a href="#geospatial地理位置" class="headerlink" title="geospatial地理位置"></a>geospatial地理位置</h4><p>将指定的地理空间位置（纬度、经度、名称）添加到指定的key中。这些数据将会存储到sorted set这样的目的是为了方便使用GEORADIUS或者GEORADIUSBYMEMBER命令对数据进行半径查询等操作。</p>
<ul>
<li>有效的经度从-180度到180度。</li>
<li>有效的纬度从-85.05112878度到85.05112878度。</li>
</ul>
<p>当坐标位置超出上述指定范围时，该命令将会返回一个错误。</p>
<p><strong>相关指令</strong></p>
<p>groadd：将指定的地理空间位置（纬度、经度、名称）添加到指定的key中。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将城市信息添加进city中，两个数字分别对应维度，经度，第三个参数代表名称</span></span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOADD city 13.361389 38.115556 <span class="string">"Palermo"</span> 15.087269 37.502669 <span class="string">"Catania"</span></span></span><br><span class="line">(integer) 2</span><br></pre></td></tr></tbody></table></figure>

<p>gropops：从key里返回所有给定位置元素的位置（经度和纬度）。GEOPOS 命令返回一个数组， 数组中的每个项都由两个元素组成： 第一个元素为给定位置元素的经度， 而第二个元素则为给定位置元素的纬度。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOPOS city Palermo Catania NonExisting</span></span><br><span class="line">1) 1) "13.361389338970184"</span><br><span class="line">   2) "38.115556395496299"</span><br><span class="line">2) 1) "15.087267458438873"</span><br><span class="line">   2) "37.50266842333162"</span><br><span class="line">3) (nil)</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> </span></span><br></pre></td></tr></tbody></table></figure>

<p>GEODIST：命令 - 返回两个给定位置之间的距离</p>
<p>指定单位的参数 unit 必须是以下单位的其中一个：</p>
<ul>
<li><strong>m</strong> 表示单位为米。</li>
<li><strong>km</strong> 表示单位为千米。</li>
<li><strong>mi</strong> 表示单位为英里。</li>
<li><strong>ft</strong> 表示单位为英尺。</li>
</ul>
<p>如果用户没有显式地指定单位参数， 那么 <code>GEODIST</code> 默认使用米作为单位。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOADD Sicily 13.361389 38.115556 <span class="string">"Palermo"</span> 15.087269 37.502669 <span class="string">"Catania"</span></span></span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEODIST Sicily Palermo Catania</span></span><br><span class="line">"166274.15156960039"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEODIST Sicily Palermo Catania km</span></span><br><span class="line">"166.27415156960038"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEODIST Sicily Palermo Catania mi</span></span><br><span class="line">"103.31822459492736"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEODIST Sicily Foo Bar</span></span><br><span class="line">(nil)</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> </span></span><br></pre></td></tr></tbody></table></figure>

<p>GEORADIUS: 命令 - 以给定的经纬度为中心， 找出某一半径内的元素</p>
<ul>
<li><code>WITHDIST</code>: 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。</li>
<li><code>WITHCOORD</code>: 将位置元素的经度和维度也一并返回。</li>
</ul>
<p>命令默认返回未排序的位置元素。 通过以下两个参数， 用户可以指定被返回位置元素的排序方式：</p>
<ul>
<li><code>ASC</code>: 根据中心的位置， 按照从近到远的方式返回位置元素。</li>
<li><code>DESC</code>: 根据中心的位置， 按照从远到近的方式返回位置元素。</li>
</ul>
<p>返回值<br>在没有给定任何 WITH 选项的情况下， 命令只会返回一个像 [“New York”,”Milan”,”Paris”] 这样的线性（linear）列表。<br>在指定了 WITHCOORD 、 WITHDIST 、 WITHHASH 等选项的情况下， 命令返回一个二层嵌套数组， 内层的每个子数组就表示一个元素。<br>在返回嵌套数组时， 子数组的第一个元素总是位置元素的名字。 至于额外的信息， 则会作为子数组的后续元素， 按照以下顺序被返回：</p>
<p>以浮点数格式返回的中心与位置元素之间的距离， 单位与用户指定范围时的单位一致。<br>geohash 整数。<br>由两个元素组成的坐标，分别为经度和纬度。<br>举个例子， GEORADIUS Sicily 15 37 200 km WITHCOORD WITHDIST 这样的命令返回的每个子数组都是类似以下格式的：</p>
<p>[“Palermo”,”190.4424”,[“13.361389338970184”,”38.115556395496299”]]</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOADD Sicily 13.361389 38.115556 <span class="string">"Palermo"</span> 15.087269 37.502669 <span class="string">"Catania"</span></span></span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEORADIUS Sicily 15 37 200 km WITHDIST</span></span><br><span class="line">1) 1) "Palermo"</span><br><span class="line">   2) "190.4424"</span><br><span class="line">2) 1) "Catania"</span><br><span class="line">   2) "56.4413"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEORADIUS Sicily 15 37 200 km WITHCOORD</span></span><br><span class="line">1) 1) "Palermo"</span><br><span class="line">   2) 1) "13.361389338970184"</span><br><span class="line">      2) "38.115556395496299"</span><br><span class="line">2) 1) "Catania"</span><br><span class="line">   2) 1) "15.087267458438873"</span><br><span class="line">      2) "37.50266842333162"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEORADIUS Sicily 15 37 200 km WITHDIST WITHCOORD</span></span><br><span class="line">1) 1) "Palermo"</span><br><span class="line">   2) "190.4424"</span><br><span class="line">   3) 1) "13.361389338970184"</span><br><span class="line">      2) "38.115556395496299"</span><br><span class="line">2) 1) "Catania"</span><br><span class="line">   2) "56.4413"</span><br><span class="line">   3) 1) "15.087267458438873"</span><br><span class="line">      2) "37.50266842333162"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> </span></span><br></pre></td></tr></tbody></table></figure>

<p> GEOHASH 命令 - 返回一个或多个位置元素的 Geohash 表示</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOADD Sicily 13.361389 38.115556 <span class="string">"Palermo"</span> 15.087269 37.502669 <span class="string">"Catania"</span></span></span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOHASH Sicily Palermo Catania</span></span><br><span class="line">1) "sqc8b49rny0"</span><br><span class="line">2) "sqdtr74hyu0"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> </span></span><br></pre></td></tr></tbody></table></figure>

<p>GEORADIUSBYMEMBER 命令 - 找出位于指定范围内的元素，中心点是由给定的位置元素决定</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOADD Sicily 13.583333 37.316667 <span class="string">"Agrigento"</span></span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEOADD Sicily 13.361389 38.115556 <span class="string">"Palermo"</span> 15.087269 37.502669 <span class="string">"Catania"</span></span></span><br><span class="line">(integer) 2</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> GEORADIUSBYMEMBER Sicily Agrigento 100 km</span></span><br><span class="line">1) "Agrigento"</span><br><span class="line">2) "Palermo"</span><br><span class="line"><span class="meta">redis&gt;</span><span class="bash"> </span></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>geo底层就是zset</p>
</blockquote>
<p>可以看出geo未给出移除元素api，我们可以使用zrem来操作</p>
<p>如：zrange Sicily -inf +inf 列出所有城市名称，zrem Sicily Palermo 删除一个城市</p>
<h4 id="Hyperloglog"><a href="#Hyperloglog" class="headerlink" title="Hyperloglog"></a>Hyperloglog</h4><p>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。</p>
<p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定 的、并且是很小的。</p>
<blockquote>
<p>什么是基数？</p>
</blockquote>
<p>比如数据集 {1, 3, 5, 7, 5, 7, 8}， 那么这个数据集的基数集为 {1, 3, 5 ,7, 8}, 基数(不重复元素)为5。 基数估计就是在误差可接受的范围内，快速计算基数。</p>
<p><strong>基本用法</strong><br>pfadd mypf  1 2 3 4 5 6 7加入数据集</p>
<p>pfadd yourpf 1 2 4 8 9</p>
<p>pcount mypf 计算基数</p>
<p>pfmerge  all mypf yourpf 将mypf，yourpf合并为all</p>
<h4 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h4><p>Redis提供的Bitmaps这个“数据结构”可以实现对位的操作。Bitmaps本身不是一种数据结构，实际上就是字符串，但是它可以对字符串的位进行操作。</p>
<p>可以把Bitmaps想象成一个以位为单位数组，数组中的每个单元只能存0或者1，数组的下标在bitmaps中叫做偏移量。单个bitmaps的最大长度是512MB，即2^32个比特位。<br><strong>基本操作</strong></p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> setbit key 10 1</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> getbit key 10</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> getbit key 11</span></span><br><span class="line">(integer) 0</span><br><span class="line">-----------------------------</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> setbit key 0 1</span></span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> setbit key 100 1</span></span><br><span class="line">(integer) 0</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> bitcount key</span></span><br><span class="line">(integer) 2</span><br></pre></td></tr></tbody></table></figure>



<h3 id="redis事务"><a href="#redis事务" class="headerlink" title="redis事务"></a>redis事务</h3><p><strong>引言</strong></p>
<blockquote>
<p>在数据库相关理论中，一个逻辑工作单元想要成为事务，就必须满足<strong>ACID</strong>，即原子性、一致性、隔离性和持久性。</p>
<ul>
<li>(1)原子性：原子性这个概念其实就是指，一个事务内的所有SQL操作都是一个整体，因此只有所有的SQL操作都完全执行成功，该事务方可以认为提交成功。如果在提交事务过程中某一条SQL语句执行失败，则整个事务必须回滚到事务提交前的状态。</li>
<li>(2)一致性：而一致性这个概念则是指，事务在完成的时候，必须要保证所有的数据都保持一致的状态，而落实到数据库的各个组成部分上，则要求开发人员能够保证数据、索引、约束、日志等在事务前后具备一致性。</li>
<li>(3)隔离性：隔离性这个概念主要针对并发，其核心思想就是不同的并发事务对数据产生的修改必须是相互隔离的，假设有两个不同的事务A和B并发执行，那么对A来讲，它在执行前的状态只有两种，即B执行前和B执行后。同理，对B来讲同样是如此，这样的特性我们就称为隔离性。</li>
<li>(4)持久性：持久性相对简单，是指事务完成以后它对数据的影响是永久性的。</li>
</ul>
</blockquote>
<h4 id="redis事务处理"><a href="#redis事务处理" class="headerlink" title="redis事务处理"></a>redis事务处理</h4><p><strong>redis事务介绍</strong></p>
<ol>
<li>Redis 的事务是通过 <strong>MULTI，EXEC，DISCARD 和 WATCH</strong> 这四个命令来完成的。</li>
<li>Redis 的单个命令都是<strong>原子性</strong>的，所以这里确保事务性的对象是<strong>命令集合</strong>。</li>
<li>Redis 将命令集合序列化并确保处于同一事务的<strong>命令集合连续且不被打断</strong>的执行</li>
<li>Redis不支持回滚操作</li>
</ol>
<p>思考：为什么 Redis 不支持事务回滚？</p>
<ul>
<li>大多数事务失败是因为<strong>语法错误或者类型错误</strong>，这两种错误，在开发阶段都是可以预见的。</li>
<li>Redis 为了<strong>性能方面</strong>就忽略了事务回滚。</li>
</ul>
<blockquote>
<p>单个 Redis 命令的执行是原子性的，但 Redis 没有在事务上增加任何维持原子性的机制，所以 Redis 事务的执行并不是原子性的。</p>
</blockquote>
<p><strong>事务处理命令</strong></p>
<p>事务处理命令会像非事务状态下一样被立刻执行</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802120751.jpeg"></p>
<p><strong>事务处理流程</strong></p>
<p>一个事务从开始到执行会经历以下三个阶段：</p>
<ul>
<li>1）开始事务。（非事务状态-&gt;事务状态）</li>
<li>2）命令入队。（并不执行）</li>
<li>3）执行事务。</li>
</ul>
<p>一个简单事务示例</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI </span><br><span class="line">OK </span><br><span class="line">127.0.0.1:6379&gt; SET Book_Name "GIt Pro" </span><br><span class="line">QUEUED </span><br><span class="line">127.0.0.1:6379&gt; SADD Program_Language "C++" "C#" "Jave" "Python"  </span><br><span class="line">QUEUED </span><br><span class="line">127.0.0.1:6379&gt; GET Book_Name </span><br><span class="line">QUEUED </span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">2) (integer) 4 </span><br><span class="line">3) "GIt Pro" </span><br></pre></td></tr></tbody></table></figure>

<h4 id="事务处理情况示例"><a href="#事务处理情况示例" class="headerlink" title="事务处理情况示例"></a>事务处理情况示例</h4><p>放弃事务</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802145006.jpeg"></p>
<p>命令性错误，所有命令均不会执行</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802145320.png"></p>
<p>运行时错误，其他命令依然执行</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802145525.png"></p>
<h4 id="redis实现乐观锁"><a href="#redis实现乐观锁" class="headerlink" title="redis实现乐观锁"></a>redis实现乐观锁</h4><p><strong>悲观锁</strong></p>
<p>总是假设最坏的情况，每次去拿数据的时候都认为别人会修改，所以每次在拿数据的时候都会上锁，这样别人想拿这个数据就会阻塞直到它拿到锁（<strong>共享资源每次只给一个线程使用，其它线程阻塞，用完后再把资源转让给其它线程</strong>）。传统的关系型数据库里边就用到了很多这种锁机制，比如行锁，表锁等，读锁，写锁等，都是在做操作之前先上锁。Java中synchronized和ReentrantLock等独占锁就是悲观锁思想的实现。</p>
<p><strong>乐观锁</strong></p>
<p>总是假设最好的情况，每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号机制和CAS算法实现。<strong>乐观锁适用于多读的应用类型，这样可以提高吞吐量</strong>，像数据库提供的类似于<strong>write_condition机制</strong>，其实都是提供的乐观锁。在Java中java.util.concurrent.atomic包下面的原子变量类就是使用了乐观锁的一种实现方式<strong>CAS</strong>实现的。</p>
<p><strong>redis实现乐观锁</strong></p>
<p>使用watch对数据加锁，当执行事务期间，被加锁数据未背修改则事务可成功执行，否则执行失败</p>
<p>先在一个连接（假设为线程1）里编写一个事务，</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">set money 100</span><br><span class="line">set out 0</span><br><span class="line">multi</span><br><span class="line">decrby money 10</span><br><span class="line">incrby out 10</span><br></pre></td></tr></tbody></table></figure>

<p>还未exec我们开启另外一个连接（假设为线程2），相当于另外一个用户，执行以下操作</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">incrby money 100</span><br></pre></td></tr></tbody></table></figure>

<p>执行完毕后我们回到线程1</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set money 100</span><br><span class="line">set out 0</span><br><span class="line">multi</span><br><span class="line">decrby money 10</span><br><span class="line">incrby out 10</span><br><span class="line">exec</span><br></pre></td></tr></tbody></table></figure>

<p>当我们执行exec后会报错，因为在我们执行事务期间监视值money已经被其他线程修改</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">unwatch 放弃监视</span><br><span class="line">watch money 监视money此时已经是最新值</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>乐观锁的一些应用：秒杀系统</p>
</blockquote>
<h2 id="jedis"><a href="#jedis" class="headerlink" title="jedis"></a>jedis</h2><p>Redis官方推荐的Java连接开发工具</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-java.html">参考学习</a></p>
<p>maven项目使用</p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p>连接到redis</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisJava</span> </span>{</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>{</span><br><span class="line">        <span class="comment">//连接本地的 Redis 服务</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"localhost"</span>);</span><br><span class="line">        <span class="comment">// 如果 Redis 服务设置了密码，需要下面这行，没有就不需要</span></span><br><span class="line">        <span class="comment">// jedis.auth("123456"); </span></span><br><span class="line">        System.out.println(<span class="string">"连接成功"</span>);</span><br><span class="line">        <span class="comment">//查看服务是否运行</span></span><br><span class="line">        System.out.println(<span class="string">"服务正在运行: "</span>+jedis.ping());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//String操作</span></span><br><span class="line">        <span class="comment">//设置 redis 字符串数据</span></span><br><span class="line">        jedis.set(<span class="string">"runoobkey"</span>, <span class="string">"www.runoob.com"</span>);</span><br><span class="line">        <span class="comment">// 获取存储的数据并输出</span></span><br><span class="line">        System.out.println(<span class="string">"redis 存储的字符串为: "</span>+ jedis.get(<span class="string">"runoobkey"</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//List操作</span></span><br><span class="line">        jedis.lpush(<span class="string">"site-list"</span>, <span class="string">"Runoob"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"site-list"</span>, <span class="string">"Google"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"site-list"</span>, <span class="string">"Taobao"</span>);</span><br><span class="line">        <span class="comment">// 获取存储的数据并输出</span></span><br><span class="line">        List&lt;String&gt; list = jedis.lrange(<span class="string">"site-list"</span>, <span class="number">0</span> ,<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;list.size(); i++) {</span><br><span class="line">            System.out.println(<span class="string">"列表项为: "</span>+list.get(i));</span><br><span class="line">        }</span><br><span class="line">        </span><br><span class="line">        ......</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>不再赘述，所有操作与命令均相似</p>
<blockquote>
<p>一个事务的栗子<span class="github-emoji"><span>📝</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dd.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span></p>
</blockquote>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802155721.png"></p>
<h2 id="springboot整合redis"><a href="#springboot整合redis" class="headerlink" title="springboot整合redis"></a>springboot整合redis</h2><p>spring系列与数据操作相关的项目为spring-data，<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data-redis">官网</a></p>
<img src="https://gitee.com/rain-sky/images/raw/master/20210802160745.png" style="zoom:50%;">

<p>在springboot2.x后，操作redis的jedis更换为lettuce。</p>
<p>jedis：采用直连，多个线程操作的话不安全，需要使用Jedis  pool ，类似BIO模式。</p>
<p>lettuce：采用netty，实例可以在多个线程中共享，不存在线程不安全情况，类似NIO模式。</p>
<blockquote>
<p>使用</p>
</blockquote>
<p><strong>导入starter</strong></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>

<p><strong>配置解析</strong></p>
<p>找到自动配置类，可以看到为我们注入了两个常用类，方法参数为一个redis连接工厂对象，点进去发现是一个接口，而此接口的实现类有两个。</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802161509.png"></p>
<p>实现类</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802164132.png"></p>
<p>看看绑定的配置类，找到配置类，可以看到一些默认配置</p>
<p><img src="https://gitee.com/rain-sky/images/raw/master/20210802161554.png"></p>
<p><strong>配置连接示例</strong></p>
<figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Redis数据库索引（默认为0）  </span></span><br><span class="line"><span class="string">spring.redis.database=0</span>  </span><br><span class="line"><span class="comment"># Redis服务器地址  </span></span><br><span class="line"><span class="string">spring.redis.host=192.168.0.24</span>  </span><br><span class="line"><span class="comment"># Redis服务器连接端口  </span></span><br><span class="line"><span class="string">spring.redis.port=6379</span>  </span><br><span class="line"><span class="comment"># Redis服务器连接密码（默认为空）  </span></span><br><span class="line"><span class="string">spring.redis.password=</span>  </span><br><span class="line"><span class="comment"># 连接池最大连接数（使用负值表示没有限制）  </span></span><br><span class="line"><span class="string">spring.redis.pool.max-active=200</span>  </span><br><span class="line"><span class="comment"># 连接池最大阻塞等待时间（使用负值表示没有限制）  </span></span><br><span class="line"><span class="string">spring.redis.pool.max-wait=-1</span>  </span><br><span class="line"><span class="comment"># 连接池中的最大空闲连接  </span></span><br><span class="line"><span class="string">spring.redis.pool.max-idle=10</span> </span><br><span class="line"><span class="comment"># 连接池中的最小空闲连接  </span></span><br><span class="line"><span class="string">spring.redis.pool.min-idle=0</span>  </span><br><span class="line"><span class="comment"># 连接超时时间（毫秒）  </span></span><br><span class="line"><span class="string">spring.redis.timeout=1000</span> </span><br></pre></td></tr></tbody></table></figure>

<p><strong>简单测试</strong></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringbootRedisApplicationTests</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>{</span><br><span class="line">        <span class="comment">//对String类型的操作</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"myKey"</span>,<span class="string">"myValue"</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">"myKey"</span>));</span><br><span class="line">        <span class="comment">//对list的操作</span></span><br><span class="line">        redisTemplate.opsForList().leftPush(<span class="string">"hello"</span>,<span class="string">"world!"</span>);</span><br><span class="line">        redisTemplate.opsForList().leftPop(<span class="string">"hello"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取连接对象</span></span><br><span class="line">        RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span><br><span class="line">        connection.flushAll();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">rain-Sky</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://rain-sky.github.io/2021/07/24/redis%E5%9F%BA%E7%A1%80/">https://rain-sky.github.io/2021/07/24/redis%E5%9F%BA%E7%A1%80/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/redis/">redis</a><a class="post-meta__tags" href="/tags/noSql/">noSql</a></div><div class="post_share"><div class="social-share" data-image="/img/ban.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/07/24/springSecurity/"><img class="prev-cover" src="/img/ban.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">springSecurity</div></div></a></div><div class="next-post pull-right"><a href="/2021/07/22/springboot/"><img class="next-cover" src="/img/ban.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">springboot</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/04/04/select-子句后的列取别名不能应用与where子句的问题/" title="select 子句后的列取别名不能应用与where子句的问题"><img class="cover" src="/img/ban.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-04</div><div class="title">select 子句后的列取别名不能应用与where子句的问题</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://gitee.com/rain-sky/images/raw/master/20210516135239.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">rain-Sky</div><div class="author-info__description">努力勇敢一点点</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">30</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">32</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">5</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/rain-sky"><i class="fab fa-github"></i><span>空间转移</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">正在施工ing...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8noSql"><span class="toc-number">1.</span> <span class="toc-text">为什么使用noSql</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E6%9C%BAmysql%E6%97%B6%E4%BB%A3"><span class="toc-number">1.1.</span> <span class="toc-text">单机mysql时代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Memcached-MySQL-%E5%9E%82%E7%9B%B4%E6%8B%86%E5%88%86"><span class="toc-number">1.2.</span> <span class="toc-text">Memcached+MySQL+垂直拆分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mysql%E4%B8%BB%E4%BB%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">1.3.</span> <span class="toc-text">Mysql主从读写分离</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8-%E6%B0%B4%E5%B9%B3%E6%8B%86%E5%88%86-mysql%E9%9B%86%E7%BE%A4"><span class="toc-number">1.4.</span> <span class="toc-text">分库分表+水平拆分+mysql集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#noSql%E7%9A%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.5.</span> <span class="toc-text">noSql的优势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.</span> <span class="toc-text">redis 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#linux%E4%B8%8B%E5%AE%89%E8%A3%85redis"><span class="toc-number">2.1.</span> <span class="toc-text">linux下安装redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.1.</span> <span class="toc-text">redis数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.</span> <span class="toc-text">五大数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#String%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.1.</span> <span class="toc-text">String字符串类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#List%E5%88%97%E8%A1%A8"><span class="toc-number">3.2.2.</span> <span class="toc-text">List列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set%E9%9B%86%E5%90%88"><span class="toc-number">3.2.3.</span> <span class="toc-text">set集合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hash%E5%93%88%E5%B8%8C"><span class="toc-number">3.2.4.</span> <span class="toc-text">Hash哈希</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#zset%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="toc-number">3.2.5.</span> <span class="toc-text">zset有序集合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E7%89%B9%E6%AE%8A%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.3.</span> <span class="toc-text">三种特殊数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#geospatial%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE"><span class="toc-number">3.3.1.</span> <span class="toc-text">geospatial地理位置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Hyperloglog"><span class="toc-number">3.3.2.</span> <span class="toc-text">Hyperloglog</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bitmaps"><span class="toc-number">3.3.3.</span> <span class="toc-text">Bitmaps</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E4%BA%8B%E5%8A%A1"><span class="toc-number">3.4.</span> <span class="toc-text">redis事务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#redis%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">3.4.1.</span> <span class="toc-text">redis事务处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86%E6%83%85%E5%86%B5%E7%A4%BA%E4%BE%8B"><span class="toc-number">3.4.2.</span> <span class="toc-text">事务处理情况示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#redis%E5%AE%9E%E7%8E%B0%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-number">3.4.3.</span> <span class="toc-text">redis实现乐观锁</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jedis"><span class="toc-number">4.</span> <span class="toc-text">jedis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#springboot%E6%95%B4%E5%90%88redis"><span class="toc-number">5.</span> <span class="toc-text">springboot整合redis</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2021/07/26/vmvare%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" title="vmvare使用记录"><img src="/img/ban.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vmvare使用记录"/></a><div class="content"><a class="title" href="/2021/07/26/vmvare%E4%BD%BF%E7%94%A8%E8%AE%B0%E5%BD%95/" title="vmvare使用记录">vmvare使用记录</a><time datetime="2021-07-26T08:10:51.000Z" title="Created 2021-07-26 16:10:51">2021-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/26/linxu%E4%BD%BF%E7%94%A8/" title="linxu使用"><img src="/img/ban.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="linxu使用"/></a><div class="content"><a class="title" href="/2021/07/26/linxu%E4%BD%BF%E7%94%A8/" title="linxu使用">linxu使用</a><time datetime="2021-07-26T08:08:59.000Z" title="Created 2021-07-26 16:08:59">2021-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/25/Swagger/" title="Swagger"><img src="/img/ban.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Swagger"/></a><div class="content"><a class="title" href="/2021/07/25/Swagger/" title="Swagger">Swagger</a><time datetime="2021-07-25T08:17:14.000Z" title="Created 2021-07-25 16:17:14">2021-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/25/shiro/" title="shiro"><img src="/img/ban.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="shiro"/></a><div class="content"><a class="title" href="/2021/07/25/shiro/" title="shiro">shiro</a><time datetime="2021-07-25T07:20:50.000Z" title="Created 2021-07-25 15:20:50">2021-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/07/24/springSecurity/" title="springSecurity"><img src="/img/ban.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="springSecurity"/></a><div class="content"><a class="title" href="/2021/07/24/springSecurity/" title="springSecurity">springSecurity</a><time datetime="2021-07-24T08:40:22.000Z" title="Created 2021-07-24 16:40:22">2021-07-24</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/ban.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By rain-Sky</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'TGj0zYjdRMW2f2kd8Jp7ehjN-gzGzoHsz',
      appKey: 'VTWVdzNGf2aAQR168F40vnOY',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'zh-CN',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-show-text.min.js" data-mobile="false" data-text="雨天,蓝色,Aimer,Hiten,抒情,纯音乐,旷野,星空,微风,蓝海" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config-diff',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>